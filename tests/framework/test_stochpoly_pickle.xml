<?xml version="1.0" encoding="UTF-8"?>
<Simulation >
    <RunInfo>
        <WorkingDir>StochasticPolyPickleTest</WorkingDir>
        <Sequence>make,train,pkDump,pkLoad,sampleNatural,samplePickle,write</Sequence>
        <Files>ROMpk</Files>
        <batchSize>1</batchSize>
    </RunInfo>

    <Distributions>
        <Uniform name="UniDist">
            <lowerBound>1</lowerBound>
            <upperBound>5</upperBound>
        </Uniform>
    </Distributions>

    <Samplers>
        <SparseGridCollocation name="SG" parallel="1">
            <variable name="x1">
                <distribution>UniDist</distribution>
            </variable>
            <variable name="x2">
                <distribution>UniDist</distribution>
            </variable>
            <ROM              class = 'Models' type = 'ROM'         >UROM</ROM>
        </SparseGridCollocation>
        <Grid name='grid'>
            <variable name="x1">
                <distribution>UniDist</distribution>
                <grid type='CDF' construction='equal' lowerBound='0.0' steps='5'>0.2</grid>
            </variable>
            <variable name="x2">
                <distribution>UniDist</distribution>
                <grid type='CDF' construction='equal' lowerBound='0.0' steps='5'>0.2</grid>
            </variable>
        </Grid>
    </Samplers>

    <Models>
        <Dummy name="MyDummy" subType=""/>
        <ExternalModel name='polynomial' subType='' ModuleToLoad = './StochasticPolyPickleTest/polynomial'>
            <variable>x1</variable>
            <variable>x2</variable>
            <variable>ans</variable>
        </ExternalModel>
        <ROM name='UROM' subType='GaussPolynomialRom'>
            <Target>ans</Target>
            <Features>x1,x2</Features>
            <IndexSet>TensorProduct</IndexSet>
            <PolynomialOrder>2</PolynomialOrder>
            <Interpolation quad='Legendre' poly='Legendre' weight='1'>x1</Interpolation>
            <Interpolation quad='Legendre' poly='Legendre' weight='1'>x2</Interpolation>
        </ROM>
        <ROM name='pROM' subType='GaussPolynomialRom'>
            <Target>ans</Target>
            <Features>x1,x2</Features>
            <IndexSet>TensorProduct</IndexSet>
            <PolynomialOrder>2</PolynomialOrder>
            <Interpolation quad='Legendre' poly='Legendre' weight='1'>x1</Interpolation>
            <Interpolation quad='Legendre' poly='Legendre' weight='1'>x2</Interpolation>
        </ROM>
    </Models>

    <Steps>
        <MultiRun name='make'>
            <Sampler class='Samplers'         type='SparseGridCollocation'>SG</Sampler>
            <Input   class='DataObjects'            type='TimePointSet'         >dummyIN</Input>
            <Model   class='Models'           type='ExternalModel'        >polynomial</Model>
            <Output  class='DataObjects'            type='TimePointSet'         >SGsolns</Output>
        </MultiRun>
        <RomTrainer name='train'>
            <Input   class='DataObjects'            type='TimePointSet'         >SGsolns</Input>
            <Output  class='Models'           type='ROM'                  >UROM</Output>
        </RomTrainer>
        <IOStep name='pkDump'>
            <Input  class='Models' type='ROM'>UROM</Input>
            <Output class='Files'  type=''   >ROMpk</Output>
        </IOStep>
        <IOStep name='pkLoad'>
            <Input  class='Files'  type=''   >ROMpk</Input>
            <Output class='Models' type='ROM'>pROM</Output>
        </IOStep>

        <MultiRun name='sampleNatural'>
            <Sampler class='Samplers' type='Grid'        >grid</Sampler>
            <Input   class='DataObjects'    type='TimePointSet'>dummyIN</Input>
            <Model   class='Models'   type='ROM'         >UROM</Model>
            <Output  class='DataObjects'    type='TimePointSet'>Usolns</Output>
        </MultiRun>
        <MultiRun name='samplePickle'>
            <Sampler class='Samplers' type='Grid'        >grid</Sampler>
            <Input   class='DataObjects'    type='TimePointSet'>dummyIN</Input>
            <Model   class='Models'   type='ROM'         >pROM</Model>
            <Output  class='DataObjects'    type='TimePointSet'>psolns</Output>
        </MultiRun>

        <IOStep name='write'>
            <Input  class='DataObjects' type='TimePointSet'>Usolns</Input>
            <Input  class='DataObjects' type='TimePointSet'>psolns</Input>
            <Output class='OutStreamManager' type='Print'>Udump</Output>
            <Output class='OutStreamManager' type='Print'>pdump</Output>
        </IOStep>
    </Steps>

    <DataObjects>
        <TimePointSet name="dummyIN">
            <Input>x1,x2</Input>
            <Output>OutputPlaceHolder</Output>
        </TimePointSet>
        <TimePointSet name='SGsolns'>
            <Input>x1,x2</Input>
            <Output>ans</Output>
        </TimePointSet>
        <TimePointSet name='Usolns'>
            <Input>x1,x2</Input>
            <Output>ans</Output>
        </TimePointSet>
        <TimePointSet name='psolns'>
            <Input>x1,x2</Input>
            <Output>ans</Output>
        </TimePointSet>
    </DataObjects>

    <OutStreamManager>
        <Print name='Udump'>
            <type>csv</type>
            <source>Usolns</source>
        </Print>
        <Print name='pdump'>
            <type>csv</type>
            <source>psolns</source>
        </Print>
    </OutStreamManager>
</Simulation>
