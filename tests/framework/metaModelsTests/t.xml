<?xml version="1.0" ?>
<Simulation verbosity="debug">
  <RunInfo>
    <WorkingDir>/Users/alfoa/projects/raven/tests/framework/metaModelsTests/metaModelLinearThread</WorkingDir>
    <Sequence>testTree,dumpResults</Sequence>
    <batchSize>2</batchSize>
    <internalParallel>False</internalParallel>
  </RunInfo>

  <Distributions>
    <Uniform name="leftTemperatureDist">
      <lowerBound>500</lowerBound>
      <upperBound>1700</upperBound>
    </Uniform>
    <Uniform name="rightTemperatureDist">
      <lowerBound>500</lowerBound>
      <upperBound>1700</upperBound>
    </Uniform>
  </Distributions>

  <Models>
    <ExternalModel ModuleToLoad="/Users/alfoa/projects/raven/tests/framework/metaModelsTests/EM_A_dummy" name="A" subType="">
      <variables>leftTemperature,rightTemperature,sumTemperature</variables>
    </ExternalModel>
    <ExternalModel ModuleToLoad="/Users/alfoa/projects/raven/tests/framework/metaModelsTests/EM_B_dummy" name="B" subType="">
      <variables>leftTemperature,rightTemperature,averageTemperature</variables>
    </ExternalModel>
    <ExternalModel ModuleToLoad="/Users/alfoa/projects/raven/tests/framework/metaModelsTests/EM_C_dummy" name="C" subType="">
        <variables>sumTemperature,averageTemperature,sumPlusAverageTemperature</variables>
    </ExternalModel>
    <ExternalModel ModuleToLoad="/Users/alfoa/projects/raven/tests/framework/metaModelsTests/EM_D_dummy" name="D" subType="">
        <variables>squareSumPlusAverageTemperature,sumPlusAverageTemperature</variables>
    </ExternalModel>
    <EnsembleModel name="fork" subType="">
      <Model class="Models" type="ExternalModel">
          A
        <Input class="DataObjects" type="PointSet">inputHolder</Input>
        <TargetEvaluation class="DataObjects" type="PointSet">Acontainer</TargetEvaluation>
      </Model>
      <Model class="Models"  type="ExternalModel">
          B
        <Input class="DataObjects" type="PointSet">inputHolder</Input>
        <TargetEvaluation class="DataObjects" type="PointSet">Bcontainer</TargetEvaluation>
      </Model>
      <Model class="Models" type="ExternalModel">
          C
        <Input class="DataObjects" type="PointSet">inputHolder</Input>
        <TargetEvaluation class="DataObjects" type="PointSet">Ccontainer</TargetEvaluation>
      </Model>
      <Model class="Models" type="ExternalModel">
          D
          <Input class="DataObjects" type="PointSet">inputHolder</Input>
          <TargetEvaluation class="DataObjects" type="PointSet">Dcontainer</TargetEvaluation>
      </Model>
    </EnsembleModel>
  </Models>

  <Samplers>
    <Grid name="MonteCarloTemperature">
      <variable name="leftTemperature">
        <distribution>leftTemperatureDist</distribution>
        <grid construction="equal" steps="7" type="value">500 600</grid>
      </variable>
      <variable name="rightTemperature">
        <distribution>rightTemperatureDist</distribution>
        <grid construction="equal" steps="7" type="value">500 600</grid>
      </variable>
    </Grid>
  </Samplers>

  <Steps>
    <MultiRun name="testTree">
      <Input class="DataObjects" type="PointSet">inputHolder</Input>
      <Model class="Models" type="EnsembleModel">fork</Model>
      <Sampler class="Samplers" type="Grid">MonteCarloTemperature</Sampler>
      <Output class="DataObjects" type="PointSet">metaModelOutputTest</Output>
      <Output class="OutStreams" type="Print">metaModelOutputTestDump</Output>
    </MultiRun>
    <IOStep name="dumpResults" pauseAtEnd="True">
      <Input class="DataObjects" type="PointSet">Acontainer</Input>
      <Input class="DataObjects" type="PointSet">Bcontainer</Input>
      <Input class="DataObjects" type="PointSet">Ccontainer</Input>
      <Input class="DataObjects" type="PointSet">metaModelOutputTest</Input>
      <Output class="OutStreams" type="Print">AcontainerDump</Output>
      <Output class="OutStreams" type="Print">BcontainerDump</Output>
      <Output class="OutStreams" type="Print">CcontainerDump</Output>
      <Output class="OutStreams" type="Print">metaModelOutputTestDump</Output>
    </IOStep>
  </Steps>

  <OutStreams>
    <Print name="AcontainerDump">
        <type>csv</type>
        <source>Acontainer</source>
    </Print>
    <Print name="BcontainerDump">
      <type>csv</type>
      <source>Bcontainer</source>
    </Print>
    <Print name="CcontainerDump">
        <type>csv</type>
        <source>Ccontainer</source>
    </Print>
    <Print name="metaModelOutputTestDump">
      <type>csv</type>
      <source>metaModelOutputTest</source>
    </Print>
  </OutStreams>

  <DataObjects>
    <PointSet name="inputHolder">
      <Input>leftTemperature,rightTemperature</Input>
      <Output>OutputPlaceHolder</Output>
    </PointSet>
    <PointSet name="Dcontainer">
        <Input>sumPlusAverageTemperature</Input>
        <Output>squareSumPlusAverageTemperature</Output>
    </PointSet>
    <PointSet name="Ccontainer">
      <Input>sumTemperature,averageTemperature</Input>
      <Output>sumPlusAverageTemperature</Output>
    </PointSet>
    <PointSet name="Acontainer">
      <Input>leftTemperature,rightTemperature</Input>
      <Output>sumTemperature</Output>
    </PointSet>
    <PointSet name="Bcontainer">
        <Input>leftTemperature,rightTemperature</Input>
        <Output>averageTemperature</Output>
    </PointSet>
    <PointSet name="metaModelOutputTest">
      <Input>leftTemperature,rightTemperature</Input>
      <Output>sumPlusAverageTemperature,averageTemperature,sumTemperature,squareSumPlusAverageTemperature</Output>
    </PointSet>
  </DataObjects>
 
</Simulation>
