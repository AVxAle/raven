<?xml version="1.0" encoding="UTF-8"?>
<Simulation>
<RunInfo>
    <WorkingDir>PreconditionedDynamicEventTree</WorkingDir>
    <Files>ideal_pump.i,ideal_pump_control.py,DET_histories.csv</Files>
    <Sequence>PreconditionedDETrunTest,testOutstreamStep</Sequence>
    <batchSize>4</batchSize>
</RunInfo>

<Models>
    <Code name='MyRAVEN' subType='RAVEN'><executable>%FRAMEWORK_DIR%/../RAVEN-%METHOD%</executable></Code>
    <PostProcessor name="csv_from_hdf5" subType='PrintCSV'>
        <paramters>all</paramters>
    </PostProcessor>
</Models>

<Distributions>
  <Uniform name="zeroToOne">
    <low>0.0</low>
    <hi>1.0</hi>
  </Uniform>
  <Uniform name="testPreconditionerMonteCarloDist1">
      <low>0.0</low>
      <hi>1.0</hi>
  </Uniform>
  <Uniform name="testPreconditionerGridDist1">
      <low>0.0</low>
      <hi>1.0</hi>
  </Uniform>
  <Uniform name="testPreconditionerGridDist2">
      <low>0.0</low>
      <hi>1.0</hi>
  </Uniform>
  <Uniform name="testPreconditionerLHSDist1">
      <low>0.0</low>
      <hi>1.0</hi>
  </Uniform>
  <Uniform name="testPreconditionerLHSDist2">
      <low>0.0</low>
      <hi>1.0</hi>
  </Uniform>
</Distributions>

<Samplers>
  <DynamicEventTree name='PreconditionedDET_test' print_end_xml="True">
      <PreconditionerSampler type='MonteCarlo' limit='2'>
          <variable name='Auxiliary|testMCpreconditioned1|initial_value' >
              <distribution>testPreconditionerMonteCarloDist1</distribution>
          </variable>
          <!-- The second sampled variable is directly performed in RAVEN (since we perform the seeding)-->
      </PreconditionerSampler>
      <PreconditionerSampler type='Grid'>
          <!-- Point sampler way (directly sampling the variable) -->
          <variable name='Auxiliary|testGridpreconditioned1|initial_value' >
              <distribution>testPreconditionerGridDist1</distribution>
              <grid type='CDF' construction='equal' steps='1' lowerBound='0.1'>0.1</grid>
          </variable>
          <!-- RAVEN way for the second distribution-->
          <Distribution name='testPreconditionerMonteCarloDist2'>
              <distribution>testPreconditionerGridDist2</distribution>
              <grid type='CDF' construction='equal' steps='1' lowerBound='0.1'>0.1</grid>
          </Distribution>
      </PreconditionerSampler>
      <PreconditionerSampler type='Stratified'>
          <!-- Point sampler way (directly sampling the variable ) -->
          <variable name='Auxiliary|testLHSpreconditioned1|initial_value' >
              <distribution>testPreconditionerLHSDist1</distribution>
              <grid type='CDF' construction='equal' steps='1' lowerBound='0.1'>0.1</grid>
          </variable>
          <!-- RAVEN way for the second distribution-->
          <Distribution name='testPreconditionerMonteCarloDist2'>
              <distribution>testPreconditionerLHSDist2</distribution>
              <grid type='CDF' construction='equal' steps='1' lowerBound='0.1'>0.1</grid>
          </Distribution>
      </PreconditionerSampler>
      <!-- DYNAMIC EVENT TREE INPUT (it goes outside an inner block like PreconditionerSampler) -->
        <Distribution name='zeroToOne'>
          <distribution >zeroToOne</distribution>
          <grid type='CDF' construction='custom'>0.1 0.8</grid>
        </Distribution>
  </DynamicEventTree>
</Samplers>
<OutStreamManager>
  <Print name='testprint_hist_hier'>
    <type>csv</type>
    <source>stories</source>
  </Print>
  <Print name='testprint_tpset_hier'>
    <type>csv</type>
    <source>timepointset</source>
  </Print>
  <Print name='testprint_hist_hier_variables'>
    <type>csv</type>
    <source>stories</source>
    <variables>Output,Input|dummy_for_branch</variables>
  </Print>
  <Print name='testprint_tpset_hier_variables'>
    <type>csv</type>
    <source>timepointset</source>
    <variables>Output,Input|dummy_for_branch</variables>
  </Print>
  <Plot name='2DHistoryPlot' dim='2' interactive='False' overwrite='True'>
        <plotSettings>
            <plot>
                <type>line</type>
                <x>stories|Output|time</x>
                <y>stories|Output|pump_mass_flow_rate</y>
                <kwargs>
                    <color>green</color>
                </kwargs>
            </plot>
            <xlabel>time [s]</xlabel>
            <ylabel>evolution</ylabel>
        </plotSettings>
        <actions>
            <how>pdf</how>
            <title>
                <text> </text>
            </title>
        </actions>
  </Plot>
  <Plot name='2DHistoryPlot_tps' dim='2' interactive='False' overwrite='True'>
        <plotSettings>
            <plot>
                <type>scatter</type>
                <x>timepointset|Output|time</x>
                <y>timepointset|Output|pump_mass_flow_rate</y>
                <kwargs>
                    <color>green</color>
                </kwargs>
            </plot>
            <xlabel>time [s]</xlabel>
            <ylabel>evolution</ylabel>
        </plotSettings>
        <actions>
            <how>pdf</how>
            <title>
                <text> </text>
            </title>
        </actions>
  </Plot>
</OutStreamManager>
<Steps>
    <MultiRun name='PreconditionedDETrunTest'>
        <Input   class='Files'            type=''                  >ideal_pump.i</Input>
        <Input   class='Files'            type=''                  >ideal_pump_control.py</Input>
        <Model   class='Models'           type='Code'              >MyRAVEN</Model>
        <Sampler class='Samplers'         type='DynamicEventTree'  >PreconditionedDET_test</Sampler>
        <Output  class='DataBases'        type='HDF5'              >testPreconditionedBranchDataBase</Output>
        <Output  class='Datas'            type='Histories'         >stories</Output>
        <Output  class='Datas'            type='TimePointSet'      >timepointset</Output>
    </MultiRun >
    <IOStep name='testOutstreamStep'>
      <Input   class='Datas'            type='Histories'       >stories</Input>
      <Input   class='Datas'            type='TimePointSet'    >timepointset</Input>
      <Output  class='OutStreamManager' type='Print'           >testprint_hist_hier</Output>
      <Output  class='OutStreamManager' type='Print'           >testprint_tpset_hier</Output>
      <Output  class='OutStreamManager' type='Print'           >testprint_hist_hier_variables</Output>
      <Output  class='OutStreamManager' type='Print'           >testprint_tpset_hier_variables</Output>
      <Output  class='OutStreamManager' type='Plot'            >2DHistoryPlot</Output>
      <Output  class='OutStreamManager' type='Plot'            >2DHistoryPlot_tps</Output>
    </IOStep>
</Steps>
<DataBases>
    <HDF5 name="testPreconditionedBranchDataBase"/>
</DataBases>
<Datas>
    <Histories name='stories' hierarchical='true'>
        <Input>dummy_for_branch</Input>
        <Output>pump_mass_flow_rate,outlet_TDV_T_bc,outlet_TDV_p_bc,inlet_TDV_T_bc,pipe2_f,inlet_TDV_p_bc,time</Output>
   </Histories>
    <TimePointSet name='timepointset' hierarchical='true'>
        <Input>dummy_for_branch</Input>
        <Output>pump_mass_flow_rate,outlet_TDV_T_bc,outlet_TDV_p_bc,inlet_TDV_T_bc,pipe2_f,inlet_TDV_p_bc,time</Output>
    </TimePointSet>
</Datas>
</Simulation>



