<Simulation verbosity='debug'>


<RunInfo>
  <WorkingDir>SafestPointPP_cdf</WorkingDir>
  <Sequence>pth1,pth2,pth5,pth6</Sequence>
  <batchSize>50</batchSize>
</RunInfo>


<Steps>
  <MultiRun name = 'pth1' pauseAtEnd = 'false'>
    <Input    class = 'DataObjects'     type = 'TimePointSet'   >grd_vl_ql_smp_dpt_dt</Input>
    <Model    class = 'Models'    type = 'ExternalModel'  >xtr_mdl</Model>
    <Sampler  class = 'Samplers'  type = 'Grid'           >grd_vl_ql_smp_dpt</Sampler>
    <Output   class = 'DataObjects'     type = 'TimePointSet'   >nt_phy_dpt_dt</Output>
  </MultiRun >

  <MultiRun name = 'pth2' pauseAtEnd = 'true'>
  	<Input            class = 'DataObjects'     type = 'TimePointSet'  >bln_smp_dt</Input>
    <Model            class = 'Models'    type = 'ExternalModel' >xtr_mdl</Model>
    <Sampler          class = 'Samplers'  type = 'Adaptive'      >dpt_smp</Sampler>
    <SolutionExport   class = 'DataObjects'     type = 'TimePointSet'  >lmt_srf_dt</SolutionExport>
    <Output           class = 'DataObjects'     type = 'TimePointSet'  >nt_phy_dpt_dt</Output>
    <Output class = 'OutStreamManager'    type = 'Print'         >lmt_srf_dmp</Output>
  </MultiRun>

  <IOStep name = 'pth6' pauseAtEnd = 'true'>
      <Input  class = 'DataObjects'            type = 'TimePointSet'  >sfs_pnt_dt_cdf</Input>
      <Output class = 'OutStreamManager' type = 'Print'         >sfs_pnt_cdf_dmp</Output>
  </IOStep>
  <PostProcess name='pth5' pauseAtEnd = 'false'>
      <Input    class = 'DataObjects'          type = 'TimePointSet'   >lmt_srf_dt</Input>
      <Model    class = 'Models'         type = 'PostProcessor'  >SP_cdf</Model>
      <Output   class = 'DataObjects'          type = 'TimePointSet'   >sfs_pnt_dt_cdf</Output>
  </PostProcess>
</Steps>

<DataObjects>
  <TimePointSet name = 'grd_vl_ql_smp_dpt_dt'>
    <Input>x1,x2,gammay</Input>
    <Output>OutputPlaceHolder</Output>
  </TimePointSet>

  <TimePointSet name = 'nt_phy_dpt_dt'>
    <Input>x1,x2,gammay</Input>
    <Output>g</Output>
  </TimePointSet>

  <TimePointSet name = 'bln_smp_dt'>
    <Input>x1,x2,gammay</Input>
    <Output>OutputPlaceHolder</Output>
  </TimePointSet>

  <TimePointSet name = 'lmt_srf_dt'>
    <Input>x1,x2,gammay</Input>
    <Output>g_zr</Output>
  </TimePointSet>

  <TimePointSet name = 'sfs_pnt_dt_cdf'>
      <Input>x1,x2,gammay</Input>
      <Output>p</Output>
  </TimePointSet>
</DataObjects>


<Distributions>
  <Normal name = 'x1_dst'>
    <upperBound>10</upperBound>
    <lowerBound>-10</lowerBound>
  	<mean>0.5</mean>
    <sigma>0.1</sigma>
  </Normal>

  <Normal name = 'x2_dst'>
    <upperBound>10</upperBound>
    <lowerBound>-10</lowerBound>
    <mean>-0.15</mean>
    <sigma>0.05</sigma>
  </Normal>

  <Normal name = 'gammay_dst'>
    <upperBound>20</upperBound>
    <lowerBound>-20</lowerBound>
    <mean>0</mean>
    <sigma>15</sigma>
  </Normal>
</Distributions>


<Samplers>
  <Grid name = 'grd_vl_ql_smp_dpt'>
    <variable name = 'x1' >
      <distribution>x1_dst</distribution>
      <grid type = 'value' construction = 'equal' steps = '10' upperBound = '10'>2</grid>
    </variable>
    <variable name='x2' >
      <distribution>x2_dst</distribution>
      <grid type = 'value' construction = 'equal' steps = '10' upperBound = '10'>2</grid>
    </variable>
    <variable name='gammay' >
      <distribution>gammay_dst</distribution>
      <grid type = 'value' construction = 'equal' steps = '10' upperBound = '20'>4</grid>
    </variable>
  </Grid>

  <Adaptive name = 'dpt_smp'>
<!--    <Assembler> -->
        <ROM              class = 'Models'    type = 'ROM'           >accelerated_ROM</ROM>
        <Function         class = 'Functions' type = 'External'      >g_zr</Function>
        <TargetEvaluation class = 'DataObjects'     type = 'TimePointSet'  >nt_phy_dpt_dt</TargetEvaluation>
<!--    </Assembler> -->
    <Convergence limit = '3000' forceIteration = 'False' weight = 'value' persistence = '5'>1e-2</Convergence>
      <variable name = 'x1'>
        <distribution>x1_dst</distribution>
      </variable>
      <variable name = 'x2'>
        <distribution>x2_dst</distribution>
      </variable>
      <variable name = 'gammay'>
        <distribution>gammay_dst</distribution>
      </variable>
  </Adaptive>
</Samplers>


<Models>
  <ExternalModel name = 'xtr_mdl' subType = '' ModuleToLoad = 'SafestPointPP/safest_point_test_xtr_mdl'>
    <variable>x1</variable>
    <variable>x2</variable>
    <variable>gammay</variable>
    <variable>g</variable>
  </ExternalModel>

  <ROM name = 'accelerated_ROM' subType = 'SciKitLearn'>
    <Features>x1,x2,gammay</Features>
    <Target>g_zr</Target>
    <SKLtype>svm|SVC</SKLtype>
    <kernel>rbf</kernel>
    <gamma>10</gamma>
    <tol>1e-5</tol>
    <C>50</C>
  </ROM>

  <PostProcessor name='SP_cdf' subType='SafestPoint' verbosity='debug'>
      <!--    <Assembler> -->
      <Distribution     class = 'Distributions'  type = 'Normal'>x1_dst</Distribution>
      <Distribution     class = 'Distributions'  type = 'Normal'>x2_dst</Distribution>
      <Distribution     class = 'Distributions'  type = 'Normal'>gammay_dst</Distribution>
      <!--    </Assembler> -->
      <controllable>
          <variable name = 'x1'>
              <distribution>x1_dst</distribution>
              <grid type = 'CDF' steps = '30'>0.033333333</grid>
          </variable>
          <variable name = 'x2'>
              <distribution>x2_dst</distribution>
              <grid type = 'value' steps = '20'>1</grid>
          </variable>
      </controllable>
      <non-controllable>
          <variable name = 'gammay'>
              <distribution>gammay_dst</distribution>
              <grid type = 'CDF' steps = '30'>0.033333333</grid>
          </variable>
      </non-controllable>
  </PostProcessor>
</Models>


<Functions>
  <External name='g_zr' file='SafestPointPP/safest_point_test_g_zr.py'>
    <variable>g</variable>
  </External>
</Functions>


<OutStreamManager>
  <Print name = 'lmt_srf_dmp'>
  	<type>csv</type>
  	<source>lmt_srf_dt</source>
  </Print>

  <Print name = 'sfs_pnt_cdf_dmp'>
      <type>csv</type>
      <source>sfs_pnt_dt_cdf</source>
  </Print>
</OutStreamManager>



</Simulation>
