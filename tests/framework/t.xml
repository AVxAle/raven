<?xml version="1.0" ?>
<Simulation verbosity="debug">
  <RunInfo>
    <WorkingDir>/Users/alfoa/projects/raven/tests/framework/AdaptiveDET</WorkingDir>
    <Sequence>AdaptiveDETrunTest,DumpResults,extract,ComputeLimitSurfacePositive</Sequence>
    <batchSize>8</batchSize>
  </RunInfo>

  <Files>
    <Input name="ideal_pump.i" type="">ideal_pump.i</Input>
    <Input name="ideal_pump_control.py" type="">ideal_pump_control.py</Input>
  </Files>

  <Models>
    <Code name="MyRAVEN" subType="RAVEN">
      <executable>%FRAMEWORK_DIR%/../RAVEN-%METHOD%</executable>
    </Code>
    <ROM name="Acc" subType="SciKitLearn">
      <Features>depressurizationOnTime,PressureFailureValue</Features>
      <Target>relapFunctionSimple</Target>
      <SKLtype>svm|SVC</SKLtype>
      <kernel>rbf</kernel>
      <gamma>0.8</gamma>
      <tol>0.0001</tol>
      <C>50</C>
    </ROM>
    <ROM name="Acc2" subType="SciKitLearn">
        <Features>depressurizationOnTime,PressureFailureValue</Features>
        <Target>relapFunctionSimple</Target>
        <SKLtype>svm|LinearSVC</SKLtype>
        <!-- <n_neighbors>2</n_neighbors>
        <weights>distance</weights>
         -->
    </ROM>
    <PostProcessor name="computeLimitSurfacePositiveNegative" subType="LimitSurface">
        <parameters>depressurizationOnTime,PressureFailureValue</parameters>
        <side>both</side>
        <ROM      class="Models"    type="ROM"     >Acc2</ROM>
        <Function class="Functions" type="External">relapFunctionSimple</Function>
    </PostProcessor>
  </Models>

  <Functions>
    <External file="/Users/alfoa/projects/raven/tests/framework/AdaptiveDET/relapFunctionSimple.py" name="relapFunctionSimple">
      <variable>depressurizationOnTime</variable>
      <variable>PressureFailureValue</variable>
      <variable>systemFailed</variable>
    </External>
  </Functions>

  <Distributions>
    <Uniform name="PressureFailureDist">
      <lowerBound>104000</lowerBound>
      <upperBound>111000</upperBound>
    </Uniform>
    <Uniform name="depresSystemDist">
      <lowerBound>0.0</lowerBound>
      <upperBound>5.0</upperBound>
    </Uniform>
  </Distributions>

  <Samplers>
    <AdaptiveDynamicEventTree name="AdaptiveDETsimple" print_end_xml="yes">
      <ROM class="Models" type="ROM">Acc2</ROM>
      <Function class="Functions" type="External">relapFunctionSimple</Function>
      <TargetEvaluation class="DataObjects" type="PointSet">adaptiveOutsimple</TargetEvaluation>
      <Convergence forceIteration="False" limit="1600" persistence="20" weight="CDF">0.0001</Convergence>
      <Distribution name="PressureFailureValue">
        <distribution>PressureFailureDist</distribution>
        <grid construction="custom" type="CDF">0.01 0.05 0.1 0.2 0.25 0.3 0.35 0.4 0.45 0.5 0.55 0.6 0.65 0.7 0.75 0.8 0.85 0.9 0.95</grid>
      </Distribution>
      <Distribution name="depressurizationOnTime">
        <distribution>depresSystemDist</distribution>
        <grid construction="custom" type="CDF">0.05 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 0.95</grid>
      </Distribution>
    </AdaptiveDynamicEventTree>
  </Samplers>

  <Steps>
    <MultiRun name="AdaptiveDETrunTest" pauseAtEnd="True">
      <Input class="Files" type="">ideal_pump.i</Input>
      <Input class="Files" type="">ideal_pump_control.py</Input>
      <Model class="Models" type="Code">MyRAVEN</Model>
      <Sampler class="Samplers" type="AdaptiveDynamicEventTree">AdaptiveDETsimple</Sampler>
      <SolutionExport class="DataObjects" type="PointSet">LimitSurfSimple</SolutionExport>
      <Output class="DataObjects" type="PointSet">adaptiveOutsimple</Output>
      <Output class="Databases" type="HDF5">AdaptiveDETsimpleDatabase</Output>
      <Output class="DataObjects" type="HistorySet">AdaptiveDETHistorySet</Output>
      <Output class="DataObjects" type="PointSet">AdaptiveDETPointset</Output>
      <Output class="DataObjects" type="PointSet">AdaptiveDETPointsetHierarchical</Output>
      <Output class="DataObjects" type="HistorySet">adaptiveOutHistorySetimple</Output>
      <Output class="OutStreamManager" type="Plot">limitSurfPlot</Output>
      <!-- <Output class="OutStreamManager" type="Plot">limitSurfPlot</Output>
      <Output class="OutStreamManager" type="Plot">outPlot</Output> -->
      
    </MultiRun>
    <IOStep name="DumpResults">
      <Input class="DataObjects" type="PointSet">AdaptiveDETPointset</Input>
      <Input class="DataObjects" type="PointSet">adaptiveOutsimple</Input>
      <Input class="DataObjects" type="PointSet">LimitSurfSimple</Input>
      <Input class="DataObjects" type="HistorySet">adaptiveOutHistorySetimple</Input>
      <Output class="OutStreamManager" type="Print">adaptiveNoHierarchicalDump</Output>
      
      <Output class="OutStreamManager" type="Print">limitSurfDump</Output>
      
      <Output class="OutStreamManager" type="Print">adaptiveNoHierarchicalDump</Output>
      <Output class="OutStreamManager" type="Print">adaptiveOutsimpleHier</Output>
      <Output class="OutStreamManager" type="Print">adaptiveOutsimpleHier_selective_Output</Output>
      <Output class="OutStreamManager" type="Print">adaptiveOutsimpleHier_selective_Input</Output>
      <Output class="OutStreamManager" type="Print">adaptiveOutsimpleHier_selective_Input_var</Output>
      <Output class="OutStreamManager" type="Print">adaptiveOutsimpleHier_selective_Output_Input_var</Output>
      <Output class="OutStreamManager" type="Print">adaptiveOutsimpleHier_selective_Input_Output_var</Output>
      <Output class="OutStreamManager" type="Print">adaptiveOutsimpleHier_selective_Output_var</Output>
      <Output class="OutStreamManager" type="Print">adaptiveOutsimpleHier_HistorySetselective_Input_Output_var</Output>
    </IOStep>
    <IOStep name="extract">
        <Input class="Databases" type="HDF5">AdaptiveDETsimpleDatabase</Input>
        <Output class="DataObjects" type="PointSet">adaptiveOutsimpleFinal</Output>
    </IOStep>
    <PostProcess name="ComputeLimitSurfacePositive" pauseAtEnd="True">
        <Input class="DataObjects" type="PointSet">adaptiveOutsimpleFinal</Input>
        <Model class="Models" type="PostProcessor">computeLimitSurfacePositiveNegative</Model>
        <Output class="DataObjects" type="PointSet">LimitSurfSimpleFinal</Output>
        <Output class="OutStreamManager" type="Plot">limitSurfPlotFinal</Output>
        <Output class="OutStreamManager" type="Plot">outPlotFinal</Output>
    </PostProcess>
  </Steps>

  <Databases>
    <HDF5 directory="AdaptiveDET" name="AdaptiveDETsimpleDatabase"/>
  </Databases>

  <OutStreamManager>
    <Print name="limitSurfDump">
      <type>csv</type>
      <source>LimitSurfSimple</source>
    </Print>
    <Print name="adaptiveNoHierarchicalDump">
      <type>csv</type>
      <source>AdaptiveDETPointset</source>
    </Print>
    <Print name="adaptiveOutsimpleHier">
      <type>csv</type>
      <source>adaptiveOutsimple</source>
    </Print>
    <Print name="adaptiveOutsimpleHier_selective_Output">
      <type>csv</type>
      <source>adaptiveOutsimple</source>
      <what>Output</what>
    </Print>
    <Print name="adaptiveOutsimpleHier_selective_Input">
      <type>csv</type>
      <source>adaptiveOutsimple</source>
      <what>Input</what>
    </Print>
    <Print name="adaptiveOutsimpleHier_selective_Input_var">
      <type>csv</type>
      <source>adaptiveOutsimple</source>
      <what>Input|PressureFailureValue</what>
    </Print>
    <Print name="adaptiveOutsimpleHier_selective_Output_Input_var">
      <type>csv</type>
      <source>adaptiveOutsimple</source>
      <what>Output,Input|PressureFailureValue</what>
    </Print>
    <Print name="adaptiveOutsimpleHier_selective_Input_Output_var">
      <type>csv</type>
      <source>adaptiveOutsimple</source>
      <what>Output|systemFailed,Input</what>
    </Print>
    <Print name="adaptiveOutsimpleHier_HistorySetselective_Input_Output_var">
      <type>csv</type>
      <source>adaptiveOutHistorySetimple</source>
      <what>Output|systemFailed,Input</what>
    </Print>
    <Print name="adaptiveOutsimpleHier_selective_Output_var">
      <type>csv</type>
      <source>adaptiveOutsimple</source>
      <what>Output|systemFailed</what>
    </Print>
      <Plot dim="2" name="limitSurfPlot" overwrite="True" verbosity="debug">
        <plotSettings>
          <plot>
            <type>scatter</type>
            <y>LimitSurfSimple|Input|PressureFailureValue</y>
            <x>LimitSurfSimple|Input|depressurizationOnTime</x>
            <colorMap>LimitSurfSimple|Output|relapFunctionSimple</colorMap>
          </plot>
        </plotSettings>
        <actions>
          <how>screen</how>
          <title>
            <text> </text>
          </title>
        </actions>
      </Plot>
      <Plot dim="2" name="limitSurfPlotFinal" overwrite="True" verbosity="debug">
          <plotSettings>
              <plot>
                  <type>scatter</type>
                  <y>LimitSurfSimpleFinal|Input|PressureFailureValue</y>
                  <x>LimitSurfSimpleFinal|Input|depressurizationOnTime</x>
                  <colorMap>LimitSurfSimpleFinal|Output|relapFunctionSimple</colorMap>
              </plot>
          </plotSettings>
          <actions>
              <how>screen</how>
              <title>
                  <text> </text>
              </title>
          </actions>
      </Plot>
      <Plot dim="2" name="outPlot" overwrite="True" verbosity="debug">
        <plotSettings>
          <plot>
            <type>scatter</type>
            <y>adaptiveOutsimple|Input|PressureFailureValue</y>
            <x>adaptiveOutsimple|Input|depressurizationOnTime</x>
            <colorMap>adaptiveOutsimple|Output|systemFailed</colorMap>
            <c>winter</c>
          </plot>
          
        </plotSettings>
        <actions>
          <how>screen</how>
          <title>
            <text> </text>
          </title>
        </actions>
      </Plot>
      <Plot dim="2" name="outPlotFinal" overwrite="True" verbosity="debug">
          <plotSettings>
              <plot>
                  <type>scatter</type>
                  <y>adaptiveOutsimpleFinal|Input|PressureFailureValue</y>
                  <x>adaptiveOutsimpleFinal|Input|depressurizationOnTime</x>
                  <colorMap>adaptiveOutsimpleFinal|Output|systemFailed</colorMap>
                  <c>winter</c>
              </plot>
              
          </plotSettings>
          <actions>
              <how>screen</how>
              <title>
                  <text> </text>
              </title>
          </actions>
      </Plot>
  </OutStreamManager>

  <DataObjects>
    <PointSet name="LimitSurfSimple">
      <Input>PressureFailureValue,depressurizationOnTime</Input>
      <Output>relapFunctionSimple</Output>
    </PointSet>
    <PointSet name="LimitSurfSimpleFinal">
        <Input>PressureFailureValue,depressurizationOnTime</Input>
        <Output>relapFunctionSimple</Output>
    </PointSet>
    <PointSet name="adaptiveOutsimpleFinal">
        <options>
            <inputRow>-1</inputRow>
        </options>
        <Input>PressureFailureValue,depressurizationOnTime</Input>
        <Output>systemFailed</Output>
    </PointSet>
    <PointSet name="AdaptiveDETPointset">
      <options>
        <inputRow>-1</inputRow>
      </options>
      <Input>PressureFailureDistThreshold,PressureFailureValue,depresSystemDistThreshold,depressurizationOnTime</Input>
      <Output>time,systemFailed,pump_mass_flow_rate,inlet_TDV_p_bc,pipe1_Area,pipe1_Dh,pipe1_Hw,depressurizationOn,endSimulation</Output>
    </PointSet>
    <PointSet hierarchical="true" name="AdaptiveDETPointsetHierarchical">
      <options>
        <inputRow>-1</inputRow>
      </options>
      <Input>PressureFailureDistThreshold,PressureFailureValue,depresSystemDistThreshold,depressurizationOnTime</Input>
      <Output>time,systemFailed,pump_mass_flow_rate,inlet_TDV_p_bc,pipe1_Area,pipe1_Dh,pipe1_Hw,depressurizationOn,endSimulation</Output>
    </PointSet>
    <PointSet hierarchical="true" name="adaptiveOutsimple">
      <options>
        <inputRow>-1</inputRow>
      </options>
      <Input>PressureFailureValue,depressurizationOnTime</Input>
      <Output>systemFailed</Output>
    </PointSet>
    <HistorySet hierarchical="true" name="adaptiveOutHistorySetimple">
      <options>
        <inputRow>-1</inputRow>
      </options>
      <Input>PressureFailureValue,depressurizationOnTime</Input>
      <Output>systemFailed</Output>
    </HistorySet>
    <HistorySet name="AdaptiveDETHistorySet">
      <options>
        <inputRow>-1</inputRow>
      </options>
      <Input>PressureFailureDistThreshold,PressureFailureValue,depresSystemDistThreshold,depressurizationOnTime</Input>
      <Output>time,systemFailed,pump_mass_flow_rate,inlet_TDV_p_bc,pipe1_Area,pipe1_Dh,pipe1_Hw,depressurizationOn,endSimulation</Output>
    </HistorySet>
  </DataObjects>

</Simulation>
