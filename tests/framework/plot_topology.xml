<?xml version="1.0" ?>
<Simulation>
  <RunInfo>
    <WorkingDir>topologyPostProcessor</WorkingDir>
    <Sequence>
    load,
    decompose,
    seg1,
    seg2,
    seg3,
    seg4,
    plot
  </Sequence>

  </RunInfo>

  <Models>
    <PostProcessor debug="true" name="AMSC" subType="TopologicalDecomposition">
      <graph>Beta Skeleton</graph>
      <gradient>steepest</gradient>
      <beta>1</beta>
      <knn>8</knn>
      <normalization>None</normalization>
      <parameters>X,Y</parameters>
      <response>Z</response>
    </PostProcessor>
    <PostProcessor debug="true" name="seg1" subType="External">
      <method>seg1</method>
      <Function class="Functions" type="External">segment</Function>
    </PostProcessor>
    <PostProcessor debug="true" name="seg2" subType="External">
      <method>seg2</method>
      <Function class="Functions" type="External">segment</Function>
    </PostProcessor>
    <PostProcessor debug="true" name="seg3" subType="External">
      <method>seg3</method>
      <Function class="Functions" type="External">segment</Function>
    </PostProcessor>
    <PostProcessor debug="true" name="seg4" subType="External">
      <method>seg4</method>
      <Function class="Functions" type="External">segment</Function>
    </PostProcessor>
  </Models>

  <Functions>
    <External file="topologyPostProcessor/GrabSegments" name="segment">
      <variable>X</variable>
      <variable>Y</variable>
      <variable>Z</variable>
      <variable>minLabel</variable>
      <variable>maxLabel</variable>
    </External>
  </Functions>

  <Steps>
    <IOStep fromDirectory="." name="load">
      <Input class="DataObjects" type="PointSet">testData</Input>
      <Output class="Databases" type="HDF5">myDB</Output>
    </IOStep>
    <PostProcess name="decompose">
      <Input class="DataObjects" type="PointSet">testData</Input>
      <Model class="Models" type="PostProcessor">AMSC</Model>
      <Output class="DataObjects" type="PointSet">outTPS</Output>
      <Output class="OutStreamManager" type="Print">myDump</Output>
    </PostProcess>
    <PostProcess name="seg1">
      <Input class="DataObjects" type="PointSet">outTPS</Input>
      <Model class="Models" type="PostProcessor">seg1</Model>
      <Output class="DataObjects" type="PointSet">seg1</Output>
    </PostProcess>
    <PostProcess name="seg2">
      <Input class="DataObjects" type="PointSet">outTPS</Input>
      <Model class="Models" type="PostProcessor">seg2</Model>
      <Output class="DataObjects" type="PointSet">seg2</Output>
    </PostProcess>
    <PostProcess name="seg3">
      <Input class="DataObjects" type="PointSet">outTPS</Input>
      <Model class="Models" type="PostProcessor">seg3</Model>
      <Output class="DataObjects" type="PointSet">seg3</Output>
    </PostProcess>
    <PostProcess name="seg4">
      <Input class="DataObjects" type="PointSet">outTPS</Input>
      <Model class="Models" type="PostProcessor">seg4</Model>
      <Output class="DataObjects" type="PointSet">seg4</Output>
    </PostProcess>
    <OutStreamStep name="plot" pauseAtEnd="True">
      <Input class="DataObjects" type="PointSet">seg1</Input>
      <Input class="DataObjects" type="PointSet">seg2</Input>
      <Input class="DataObjects" type="PointSet">seg3</Input>
      <Input class="DataObjects" type="PointSet">seg4</Input>
      <Output class="OutStreamManager" type="Plot">Topological Decomposition</Output>
    </OutStreamStep>
  </Steps>

  <OutStreamManager>
    <Print name="myDump">
      <type>csv</type>
      <source>outTPS</source>
    </Print>
    <Plot dim="3" interactive="True" name="Topological Decomposition">
      <actions>
        <how>screen</how>
      </actions>
      <plotSettings>
        <plot>
          <type>scatter</type>
          <x>seg1|Input|X</x>
          <y>seg1|Input|Y</y>
          <z>seg1|Output|Z</z>
          <c>yellow</c>
          <kwargs/>
        </plot>
        <plot>
          <type>scatter</type>
          <x>seg2|Input|X</x>
          <y>seg2|Input|Y</y>
          <z>seg2|Output|Z</z>
          <c>red</c>
          <kwargs/>
        </plot>
        <plot>
          <type>scatter</type>
          <x>seg3|Input|X</x>
          <y>seg3|Input|Y</y>
          <z>seg3|Output|Z</z>
          <c>blue</c>
          <kwargs/>
        </plot>
        <plot>
          <type>scatter</type>
          <x>seg4|Input|X</x>
          <y>seg4|Input|Y</y>
          <z>seg4|Output|Z</z>
          <c>green</c>
          <kwargs/>
        </plot>
      </plotSettings>
    </Plot>
  </OutStreamManager>

  <Databases>
    <HDF5 name="myDB"/>
  </Databases>

  <DataObjects>
    <PointSet name="testData">
      <Input>X,Y</Input>
      <Output>Z</Output>
    </PointSet>
    <PointSet name="outTPS">
      <Input>X,Y</Input>
      <Output>Z,minLabel,maxLabel</Output>
    </PointSet>
    <PointSet name="seg1">
      <Input>X,Y</Input>
      <Output>Z</Output>
    </PointSet>
    <PointSet name="seg2">
      <Input>X,Y</Input>
      <Output>Z</Output>
    </PointSet>
    <PointSet name="seg3">
      <Input>X,Y</Input>
      <Output>Z</Output>
    </PointSet>
    <PointSet name="seg4">
      <Input>X,Y</Input>
      <Output>Z</Output>
    </PointSet>
  </DataObjects>

</Simulation>
