<?xml version="1.0" ?>
<Simulation verbosity='debug'>
  <RunInfo>
    <WorkingDir>topology</WorkingDir>
    <Sequence>adapt,adaptdump</Sequence>
    <batchSize>4</batchSize>
  </RunInfo>

  <Steps>
    <MultiRun name="adapt">
      <Input class="DataObjects" type="PointSet">dummyIn</Input>
      <Model class="Models" type="ExternalModel">circle</Model>
      <Sampler class="Samplers" type="LimitSurfaceBatchSearch">adaptiveSearch</Sampler>
      <SolutionExport class="DataObjects" type="PointSet">limit_surface</SolutionExport>
      <Output class="DataObjects" type="PointSet">function</Output>
    </MultiRun>
    <IOStep name="adaptdump" verbosity='silent'>
      <Input class="DataObjects" type="PointSet">limit_surface</Input>
      <Output class="OutStreamManager" type="Print">limitSurfaceDump</Output>
      <Input class="DataObjects" type="PointSet">function</Input>
      <Output class="OutStreamManager" type="Print">samplesDump</Output>
    </IOStep>
  </Steps>

  <DataObjects verbosity='silent'>
    <PointSet name="dummyIn" verbosity='silent'>
      <Input>x1,x2</Input>
      <Output>OutputPlaceHolder</Output>
    </PointSet>
    <PointSet name="function" verbosity='silent'>
      <Input>x1,x2</Input>
      <Output>y</Output>
    </PointSet>
    <PointSet name="limit_surface" verbosity='silent'>
      <Input>x1,x2</Input>
      <Output>label</Output>
    </PointSet>
  </DataObjects>

  <Distributions verbosity='silent'>
    <Uniform name="uniform" verbosity='silent'>
      <upperBound>1</upperBound>
      <lowerBound>-1</lowerBound>
    </Uniform>
  </Distributions>

  <Samplers>
    <LimitSurfaceBatchSearch name="adaptiveSearch">
      <ROM      class="Models"    type="ROM"     >mySVM</ROM>
      <Function class="Functions" type="External">label</Function>
      <TargetEvaluation class="DataObjects" type="PointSet">function</TargetEvaluation>
      <Convergence forceIteration="False" limit="30" persistence="25" weight="value">9e-5</Convergence>
      <!-- <Convergence forceIteration="False" limit="3000" persistence="25" weight="value">9e-5</Convergence> -->
      <generateCSVs />
      <trainSize>10</trainSize>
      <batchSize>8</batchSize>
      <scoring>distance</scoring>
      <batchStrategy>naive</batchStrategy>
      <variable name="x1">
        <distribution>uniform</distribution>
      </variable>
      <variable name="x2">
        <distribution>uniform</distribution>
      </variable>
    </LimitSurfaceBatchSearch>
  </Samplers>

  <Models verbosity='silent'>
    <ExternalModel ModuleToLoad="topology/circle" name="circle" subType="" verbosity='silent'>
      <variable>x1</variable>
      <variable>x2</variable>
      <variable>y</variable>
    </ExternalModel>
    <ROM name="mySVM" subType="SciKitLearn" verbosity='silent'>
      <Features>x1,x2</Features>
      <Target>label</Target>
      <SKLtype>svm|SVC</SKLtype>
      <kernel>rbf</kernel>
      <gamma>10</gamma>
      <tol>1e-5</tol>
      <C>50</C>
    </ROM>
  </Models>

  <Functions verbosity='silent'>
    <External file="topology/goal" name="label" verbosity='silent'>
      <variable>y</variable>
    </External>
  </Functions>

  <OutStreamManager verbosity='silent'>
    <Print name="limitSurfaceDump" verbosity='silent'>
      <type>csv</type>
      <source>limit_surface</source>
    </Print>
    <Print name="samplesDump" verbosity='silent'>
      <type>csv</type>
      <source>function</source>
    </Print>
  </OutStreamManager>

</Simulation>
