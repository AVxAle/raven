\section{Samplers  \\ \vspace{2 mm} {\small }}
\label{sec:Samplers}
The sampler is probably the most important entity in the RAVEN framework. Indeed, it performs the driving of the specific sampling strategy and, hence, determines the effectiveness of the analysis, from both an accuracy and computational point of view.  The samplers, that are available in RAVEN, can be categorized in three main classes:
\begin{itemize}
\item \textbf{Once-through}
\item \textbf{Dynamic Event Tree (DET)}
\item \textbf{Adaptive}
\end{itemize}
Before analyzing  each sampler in details, it is important to mention that each type has a similar syntax to input the variables that need to be ``sampled''. In the example below the variable ``variableName'' is going to be sampled by the Sampler ``WhatEverSampler'' using the distribution ``aDistribution''. 
\begin{lstlisting}[style=XML]
--------------------------------------------
<Simulation>
  ...
  <Samplers>
    ...
    <WhatEverSampler name='whatever'>
      ...
     <variable name='variableName'> 
       ...
       <distribution>aDistribution</distribution>
       ...
     </variable>
      ... 
    </WhatEverSampler>
    ...
  </Samplers>
  ...
</Simulation>
--------------------------------------------
\end{lstlisting}
As reported in section \ref{sec:existingInterface}, the variable naming syntax, for external driven codes, depends on the way the ``code interface'' has been implemented. For example, if the code has an input structure like the one reported below, the variable name would be ``$I-Level|II-Level|variable$''; in this way, the relative code interface (and input parser) will know which variable needs to be perturbed and the ``recipe'' to access to it. As reported in \ref{sec:existingInterface}, its syntax is  chosen by the developer of the ``code interface'' and is implemented in the interface only (no modifications are needed in the RAVEN code).

\begin{lstlisting}[style=XML]
--------------------------------------------
Example Input:
[I-Level]
  [./II-Level]
    variable = xxx
  [../]
[]
XML relative 
----------
Example XML block:
<variable name=''I-Level|II-Level|variable''> 
  <distribution>exampleDistribution</distribution>
</variable>
--------------------------------------------
\end{lstlisting}
%%% Once-Through Samplers
\subsection{Once-through Samplers.}
\label{subsec:onceThroughSamplers}
The once-through sampler category collects all the strategies that perform the sampling of the input space without exploiting, through dynamic learning approaches, the information made available from the outcomes of calculation previously performed (adaptive sampling) and the common system evolution (patterns) that different sampled calculations can generate in the phase space (dynamic event tree). 
In the RAVEN framework, five different and well-known “once-through” samplers are available: 
\begin{itemize}
\item \textbf{Monte Carlo (MC)}
\item \textbf{Stratified}
\item \textbf{Grid Based}
\item \textbf{Response Surface Design of Experiment}
\item \textbf{Factorial Design of Experiment}
\end{itemize}
From a practical point of view, these sampling strategies represent different ways to perturb the input space. In the following paragraphs, the input requirements and a small explaination of the different sampling methodologies are reported.
%%% Once-Through Samplers: MonteCarlo
\subsubsection{Monte Carlo.}
\label{subsubsubsec:MC}
\textbf{Monte-Carlo} sampling approach is one of the most well-known and used approaches to perform exploration of the input space. The main idea, behind it, is the random perturbation of the input space accordingly with uniform or parameter-based probability density functions. 
\\ The specifications of this Sampler must be defined within the xml block $<MonteCarlo>$. This xml-node needs to contain the attribute:
\vspace{-5mm}
\begin{itemize}
\itemsep0em
\item \textbf{name}, \textit{required string attribute}, user-defined name of this Sampler. N.B. As for the other objects, this is the name that can be used to refer to this specific entity from other input blocks (xml);
\item \textbf{limit}, \textit{required integer attribute}, number of MonteCarlo samples needs to be generated;
\item \textbf{initial\_seed}, \textit{optional integer attribute}, initial seeding of random number generator. \textit{Default = random seed};
\item \textbf{reseedAtEachIteration}, \textit{optional boolean/string attribute}, perform a re-seeding for each sample generated (True values = True, yes, y, t, si, dajie). \textit{Default = False}; 
\end{itemize}
\vspace{-5mm}
In the \textbf{MonteCarlo} input block, the user needs to specify the variables need to be sampled. As already mentioned, these variables are inputted within consecutive xml blocks called $<variable>$:
\begin{itemize}
\item $<variable>$, xml node, required parameter. This xml-node needs to contain the attribute:
\begin{itemize}
  \item \textbf{name}, \textit{required string attribute}, user-defined name of this variable. 
\end{itemize}
 In the variable node, the following xml-nodes need to be specified:
 \begin{itemize}
    \item $<distribution>$\textbf{\textit{, string, required field.}}. Name of the distribution that is associated to this variable. Its name needs to be contained in the \textbf{Distributions} block explained in sections \ref{sec:distributions}.
  \end{itemize}
\end{itemize}

\begin{lstlisting}[style=XML]
---------------------------------------------------------
Example:
---------------------------------------------------------
<Samplers>
  ...
  <MonteCarlo name='MCname' limit='10' initial_seed='200286' reseedAtEachIteration='false'> 
    <variable name='var1'> 
      <distribution>***</distribution> 	
    </variable> 
  </MonteCarlo>
  ...
</Samplers>
---------------------------------------------------------
\end{lstlisting}
%%% Once-Through Samplers: Grid
\subsubsection{Grid.}
\label{subsubsubsec:Grid}
\textbf{Grid} sampling approach is probably the simplest exploration approach that can be employed to explore the uncertain domain. The main idea, behind it, is the construction of a N-Dimensional grid, where each dimension is represented by the uncertain variables. This approach performs the sampling of each node of the grid.  The sampling of the grid consists in evaluating the answer of the system under all the possible combinations among the different variables' values, with respect a predefined discretization metric.  In RAVEN two discretization metrics are available: 1) Cumulative Distribution Function, and 2) Value. Thus, the grid meshing can be inputted either in probability or in absolute values.
\\ The specifications of this Sampler must be defined within the xml block $<Grid>$. This xml-node needs to contain the attribute:
\begin{itemize}
\itemsep0em
\item \textbf{name}, \textit{required string attribute}, user-defined name of this Sampler. N.B. As for the other objects, this is the name that can be used to refer to this specific entity from other input blocks (xml);
\end{itemize}
In the \textbf{Grid} input block, the user needs to specify the variables need to be sampled. As already mentioned, these variables are inputted within consecutive xml blocks called $<variable>$:
\begin{itemize}
\item $<variable>$, xml node, required parameter. This xml-node needs to contain the attribute:
\begin{itemize}
  \item \textbf{name}, \textit{required string attribute}, user-defined name of this variable. 
 \end{itemize}
 In the variable node, the following xml-nodes need to be specified:
 \begin{itemize}
    \item $<distribution>$\textbf{\textit{, string, required field.}}. Name of the distribution that is associated to this variable. Its name needs to be contained in the \textbf{Distributions} block explained in sections \ref{sec:distributions};
    \item $<grid>$\textbf{\textit{, float or space separated floats, required field.}}. The content of this xml node depends on the definition of the associated attributes:
\begin{itemize}
\itemsep0em
\item \textbf{type}, \textit{required string attribute}, user-defined discretization metric type: 1) $CDF$, the grid is going to be specified based on  Cumulative Distribution Function probability thresholds, and 2) $value$, the grid is going to be provided inputting absolute variable values;
\item \textbf{construction}, \textit{required string attribute}, how the grid needs to be constructed, independently by the its type (i.e. $CDF$ or $value$). 
\end{itemize}

Based on the $construction$ type, the content of the $<grid>$ xml node and the requirements for other attributes change:
\begin{itemize}
  \item \textit{construction = ``equal''}. The grid is going to be constructed equally-spaced ( type = ``value'') or equally-probable (type == ``CDF''). This construction type requires the definition of additional attributes:
      \begin{itemize}
         \item \textbf{steps}, \textit{required integer attribute}, number of equally-spaced/probable discretization steps.
         \item \textbf{upperBound}, \textit{required float attribute}, the upper limit of the grid. 
        NB. This attribute must be specified if the \textbf{lowerBound} has not been defined;
         \item \textbf{lowerBound}, \textit{required float attribute}, the lower limit of the grid.
        NB. This attribute must be specified if the \textbf{upperBound} has not been defined;
      \end{itemize}
      This construction type requires that the content of the xml node $<grid>$ represents the step size (either in probability or value). The attributes \textbf{lowerBound} and \textbf{upperBound} are mutually exclusive (only one of them can be specified):
      \\ If the \textit{upperBound} is present, the grid lower bound is going to be at the $upperBound - steps*stepSize$
      \\ If the \textit{lowerBound} is present, the grid upper bound is going to be at the $lowerBound + steps*stepSize$
      The lower and upper bounds are checked against the associated $<distribution>$ bounds. If one or both of them fell/s outside the distribution's bounds, the code is going to raise an error.
  \item \textit{construction = ``custom''}. The grid is going to directly be specified by the user. No additional attributes are needed. 
     \\This construction type requires that the xml node $<grid>$  contains the actual mesh bins. For example, if the grid ``type'' is ``CDF'', in the body of $<grid>$, the user is going to specify CDF probability thresholds (nodalization in probability).
\end{itemize}
  \end{itemize}
\end{itemize}
\begin{lstlisting}[style=XML]
---------------------------------------------------------
Example:
---------------------------------------------------------
<Samplers>
  ...
  <Grid name='Gridname'> 
    <variable name='var1'> 
      <distribution>***</distribution>
      <grid	type='value' construction='equal' steps='100' lowerBound='1.0'>0.2</grid>	
    </variable> 
    <variable name='var2'> 
      <distribution>***</distribution>
      <grid	type='CDF' construction='equal' steps='5' lowerBound='0.0'>0.2</grid>	
    </variable>
    <variable name='var3'> 
      <distribution>***</distribution>
      <grid	type='value' construction='equal' steps='100' upperBound='21.0'>0.2</grid>	
    </variable> 
    <variable name='var4'> 
      <distribution>***</distribution>
      <grid	type='CDF' construction='equal' steps='5' upperBound='1.0'>0.2</grid>	
    </variable>
    <variable name='var5'> 
      <distribution>***</distribution>
      <grid	type='value' construction='custom'>0.2 0.5 10.0</grid>	
    </variable> 
    <variable name='var6'> 
      <distribution>***</distribution>
      <grid	type='CDF' construction='custom'>0.2 0.5 1.0</grid>	
    </variable>
  </Grid>
  ...
</Samplers>
---------------------------------------------------------
\end{lstlisting}
 Stratification is the process of dividing members of the population into homogeneous subgroups before sampling. The strata should be mutually exclusive: every element in the population must be assigned to only one stratum. The strata should also be collectively exhaustive: no population element can be excluded. Then simple random sampling or systematic sampling is applied within each stratum. This often improves the representativeness of the sample by reducing sampling error. It can produce a weighted mean that has less variability than the arithmetic mean of a simple random sample of the population.

In computational statistics, stratified sampling is a method of variance reduction when Monte Carlo methods are used to estimate population statistics from a known population.

%%% Once-Through Samplers: Stratified
\subsubsection{Stratified.}
\label{subsubsubsec:Stratified}
\textbf{Stratified} sampling approach is a method for the exploration of the input space that basically consists in dividing the uncertain domain into  subgroups before sampling. In the ``stratified'' sampling, these subgroups must be:
\begin{itemize}
 \item mutually exclusive: every element in the population must be assigned to only one stratum (subgroup);
 \item collectively exhaustive: no population element can be excluded.
\end{itemize}
Then simple random sampling or systematic sampling is applied within each stratum. It is worth to notice that the well-known Latin Hyper Cube sampling represents a specialization of the Stratified approach, when the domain strata are constructed in equally-probable CDF bins.
\\ The specifications of this Sampler must be defined within the xml block $<Stratified>$. This xml-node needs to contain the attribute:
\begin{itemize}
\itemsep0em
\item \textbf{name}, \textit{required string attribute}, user-defined name of this Sampler. N.B. As for the other objects, this is the name that can be used to refer to this specific entity from other input blocks (xml);
\end{itemize}
In the \textbf{Stratified} input block, the user needs to specify the variables need to be sampled. As already mentioned, these variables are inputted within consecutive xml blocks called $<variable>$:
\begin{itemize}
\item $<variable>$, xml node, required parameter. This xml-node needs to contain the attribute:
\begin{itemize}
  \item \textbf{name}, \textit{required string attribute}, user-defined name of this variable. 
 \end{itemize}
 In the variable node, the following xml-nodes need to be specified:
 \begin{itemize}
    \item $<distribution>$\textbf{\textit{, string, required field.}}. Name of the distribution that is associated to this variable. Its name needs to be contained in the \textbf{Distributions} block explained in sections \ref{sec:distributions};
    \item $<grid>$\textbf{\textit{, float or space separated floats, required field.}}. The content of this xml node depends on the definition of the associated attributes:
\begin{itemize}
\itemsep0em
\item \textbf{type}, \textit{required string attribute}, user-defined discretization metric type: 1) $CDF$, the grid is going to be specified based on  Cumulative Distribution Function probability thresholds, and 2) $value$, the grid is going to be provided inputting absolute variable values;
\item \textbf{construction}, \textit{required string attribute}, how the grid needs to be constructed, independently by the its type (i.e. $CDF$ or $value$). 
\end{itemize}
Based on the $construction$ type, the content of the $<grid>$ xml node and the requirements for other attributes change:
\begin{itemize}
  \item \textit{construction = ``equal''}. The grid is going to be constructed equally-spaced ( type = ``value'') or equally-probable (type == ``CDF''). This construction type requires the definition of additional attributes:
      \begin{itemize}
         \item \textbf{steps}, \textit{required integer attribute}, number of equally-spaced/probable discretization steps.
         \item \textbf{upperBound}, \textit{required float attribute}, the upper limit of the grid. 
        NB. This attribute must be specified if the \textbf{lowerBound} has not been defined;
         \item \textbf{lowerBound}, \textit{required float attribute}, the lower limit of the grid.
        NB. This attribute must be specified if the \textbf{upperBound} has not been defined;
      \end{itemize}
      This construction type requires that the content of the xml node $<grid>$ represents the step size (either in probability or value). The attributes \textbf{lowerBound} and \textbf{upperBound} are mutually exclusive (only one of them can be specified):
      \\ If the \textit{upperBound} is present, the grid lower bound is going to be at the $upperBound - steps*stepSize$
      \\ If the \textit{lowerBound} is present, the grid upper bound is going to be at the $lowerBound + steps*stepSize$
      The lower and upper bounds are checked against the associated $<distribution>$ bounds. If one or both of them fell/s outside the distribution's bounds, the code is going to raise an error.
  \item \textit{construction = ``custom''}. The grid is going to directly be specified by the user. No additional attributes are needed. 
     \\This construction type requires that the xml node $<grid>$  contains the actual mesh bins. For example, if the grid ``type'' is ``CDF'', in the body of $<grid>$, the user is going to specify CDF probability thresholds (nodalization in probability).
\end{itemize}
  \end{itemize}
\end{itemize}
As it is inferable from above, the input specifications for the \textbf{Stratified} sampler are similar the Grid sampler ones. It is important to mention again that for each zone (grid mesh) only a point, randomly selected, is picked and not all the nodal combinations (like in the Grid sampling).

\begin{lstlisting}[style=XML]
---------------------------------------------------------
Example:
---------------------------------------------------------
<Samplers>
  ...
  <Stratified name='StratifiedName'> 
    <variable name='var1'> 
      <distribution>***</distribution>
      <grid	type='CDF' construction='equal' steps='5' lowerBound='0.0'>0.2</grid>	
    </variable>
    <variable name='var2'> 
      <distribution>***</distribution>
      <grid	type='value' construction='equal' steps='100' upperBound='21.0'>0.2</grid>	
    </variable> 
    <variable name='var3'> 
      <distribution>***</distribution>
      <grid	type='CDF' construction='custom'>0.2 0.5 1.0</grid>	
    </variable>
  </Stratified>
  ...
</Samplers>
---------------------------------------------------------
\end{lstlisting}

%%% Once-Through Samplers: MonteCarlo
\subsubsection{Response Surface Design of Experiment.}
\label{subsubsubsec:RespSurfDOE}
\textbf{Monte-Carlo} sampling approach is one of the most well-known and used approaches to perform exploration of the input space. The main idea, behind it, is the random perturbation of the input space accordingly with uniform or parameter-based probability density functions. 
\\ The specifications of this Sampler must be defined within the xml block $<MonteCarlo>$. This xml-node needs to contain the attribute:
\vspace{-5mm}
\begin{itemize}
\itemsep0em
\item \textbf{name}, \textit{required string attribute}, user-defined name of this Sampler. N.B. As for the other objects, this is the name that can be used to refer to this specific entity from other input blocks (xml);
\item \textbf{limit}, \textit{required integer attribute}, number of MonteCarlo samples needs to be generated;
\item \textbf{initial\_seed}, \textit{optional integer attribute}, initial seeding of random number generator. \textit{Default = random seed};
\item \textbf{reseedAtEachIteration}, \textit{optional boolean/string attribute}, perform a re-seeding for each sample generated (True values = True, yes, y, t, si, dajie). \textit{Default = False}; 
\end{itemize}
\vspace{-5mm}
In the \textbf{MonteCarlo} input block, the user needs to specify the variables need to be sampled. As already mentioned, these variables are inputted within consecutive xml blocks called $<variable>$:
\begin{itemize}
\item $<variable>$, xml node, required parameter. This xml-node needs to contain the attribute:
\begin{itemize}
  \item \textbf{name}, \textit{required string attribute}, user-defined name of this variable. 
\end{itemize}
 In the variable node, the following xml-nodes need to be specified:
 \begin{itemize}
    \item $<distribution>$\textbf{\textit{, string, required field.}}. Name of the distribution that is associated to this variable. Its name needs to be contained in the \textbf{Distributions} block explained in sections \ref{sec:distributions}.
  \end{itemize}
\end{itemize}

\begin{lstlisting}[style=XML]
---------------------------------------------------------
Example:
---------------------------------------------------------
<Samplers>
  ...
  <MonteCarlo name='MCname' limit='10' initial_seed='200286' reseedAtEachIteration='false'> 
    <variable name='var1'> 
      <distribution>***</distribution> 	
    </variable> 
  </MonteCarlo>
  ...
</Samplers>
---------------------------------------------------------
\end{lstlisting}




For the Adaptive method:
\begin{itemize}
\item \textbf{Adaptive}
\begin{itemize}
\item name
\item initial seed (optional)
\end{itemize}
\item Convergence
\begin{itemize}
\item limit: 'Integer'
\item persistence: 'Integer'
\item weight='probability' or 'None': 
\item subGridTol='None' or 'Float' :This is the tolerance used to construct the testing sub grid
\item forcelteration='True' or 'False': this flag control if at least a self.limit number of iteration should be done
\end{itemize}
\item variable
\item distribution
\end{itemize}

\begin{lstlisting}[style=XML]
<Adaptive name='***' initial_seed='***'> 
 <Convergence limit='***' persistence='***' weight='***' subGridTol='***' forcelteration='***'>***</Convergence>  
  <variable name='***'>
   <distribution>***</distribution>
  </variable> 
</Adaptive>   
\end{lstlisting}



For DynamicEventTree:
***

For AdaptiveDynamicEventTree:
***


























