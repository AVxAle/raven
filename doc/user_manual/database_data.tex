\section{DataObjects}
\label{sec:DataObjects}

As seen in the previous chapters, different entities in the RAVEN
code interact with each other in order to create, ideally, an infinite number of
different calculation flows.
%
These interactions are made possible through a data handling system that each
entity understands.
%
This system, neglecting the grammar imprecision, is called the ``DataObjects''
system.

The \xmlNode{DataObjects} tag is a container of data objects of various types that can
be constructed during the execution of a particular calculation flow.
%
These data objects can be used as input or output for a particular
\textbf{Model} (see Roles' meaning in section \ref{sec:models}), etc.
%
Currently, RAVEN supports 4 different data types, each with a particular
conceptual meaning.
%
These data types are instantiated as sub-nodes in the \xmlNode{DataObjects} block of
an input file:
\begin{itemize}
  \item \xmlNode{TimePoint}, as the name suggests, describes the state of the
  system at a certain point in time.
  %
  In other words, it can be considered a mapping between a set of parameters
  in the input space and the resulting outcomes in the output space at a
  particular time.
  %
  \item \xmlNode{TimePointSet} is a collection of individual \textit{TimePoint}
  objects.
  %
  It can be considered a mapping between multiple sets of parameters in the
  input space and the resulting sets of outcomes in the output space at a
  particular point in time.
  %
  \item \xmlNode{History} describes the temporal evolution of the state of the
  system within a certain input domain.
  %
  \item \xmlNode{Histories} is a collection of individual \textit{History}
  objects.
  %
  It can be considered a mapping between multiple sets of parameters in the
  input space and the resulting sets of temporal evolutions in the output
  space.
  %
\end{itemize}

As noted above, each data object represents a mapping between a set of
parameters and the resulting outcomes.
%
The data objects are defined within the main XML block called \xmlNode{DataObjects}:
\begin{lstlisting}[style=XML]
<Simulation>
   ...
  <DataObjects>
    <TimePoint name='***'>...</TimePoint>
    <TimePointSet name='***'>...</TimePointSet>
    <History name='***'>...</History>
    <Histories name='***'>...</Histories>
  </DataObjects>
   ...
</Simulation>
\end{lstlisting}

Independent of the type of data, the respective XML node has the following
available attributes:
\vspace{-5mm}
\begin{itemize}
  \itemsep0em
  \item \xmlAttr{name}, \xmlDesc{required string attribute}, is a user-defined
  identifier for this data object.
    %
  \nb As with other objects, this name can be used to refer to this specific
  entity from other input blocks in the XML.
  %
%  % Regarding the time attribute, we need to take a better decision... Now it is very confusing.
%  \item \xmlAttr{time}, \xmlDesc{optional float or string attribute}, time
%    attribute.
%    %
%    Here, the user can specify either the time (value) at which the outcomes
%    need to be taken (History-like object, it represents the time from which the
%    outcomes' evolution need to be tracked) or a string  that can be either
%    ``end'', at the end of the history, or ``all'', consider.
%    %
%    \default{random seed};
  \item \xmlAttr{inputTs}, \xmlDesc{optional integer attribute}, used to
  specify at which ``time step'' the input space needs to be retrieved.
  %
  \nb If the user wants to take conditions from the end of the simulation, s/he
  can directly input ``-1.''
  %
  \default{0}
  \item \xmlAttr{operator}, \xmlDesc{optional string attribute}, is aimed at
  performing simple operations on the data to be stored.
  %
  %
  The 3 options currently available are:
  \begin{itemize}
    \item \xmlString{max}
    \item \xmlString{min}
    \item \xmlString{average}
  \end{itemize}
  %
  \default{None}

  \item \xmlAttr{historyName}, \xmlDesc{optional string attribute}, in the case  the 
   ``DataObject'' type is either a \textit{TimePoint} or a
  \textit{History}, this XML node contains the name of the associated history needs to be placed in.
  \\\nb This attribute is a required parameter when the  \textit{TimePoint} or \textit{History}
   types are constructed from a Database (e.g.HDF5).

  \item \xmlAttr{hierarchical}, \xmlDesc{optional boolean attribute}, if True
  this data object will be constructed, if possible, in a hierarchical fashion.
  %
  \default{False}
\end{itemize}
\vspace{-5mm}
In each XML node (e.g. \xmlNode{TimePoint} or \xmlNode{Histories}), the user
needs to specify the following sub-nodes:
\begin{itemize}
  \item \xmlNode{Input}, \xmlDesc{comma separated string, required field} lists
  the input parameters to which this data is connected.
  %
  \item \xmlNode{Output}, \xmlDesc{comma separated string, required field} lists
  the output parameters to which this data is connected.
  %
\end{itemize}

\begin{lstlisting}[style=XML,morekeywords={inputTs,operator,hierarchical,name,history}]
<DataObjects>
  <TimePoint name='TP' inputTs='-1' operator='max' hierarchical='False'>
    <Input history='a_history_name'>var1,var2,var3</Input>
    <Output>result1,result2</Output>
  </TimePoint>
  <TimePointSet name='TPS'>
    <Input>var1,var2,var3</Input>
    <Output>result1,result2</Output>
  </TimePointSet>
  <History name='HIST'>
    <Input history='a_history_name'>var1,var2,var3</Input>
    <Output>result1,result2</Output>
  </History>
  <Histories name='HISTs'>
    <Input>var1,var2,var3</Input>
    <Output>result1,result2</Output>
  </Histories>
</DataObjects>
\end{lstlisting}

\section{Databases}
\label{sec:Databases}
The RAVEN framework provides the capability to store and retrieve data to/from
an external database.
%
Currently RAVEN has support for only a database type called \textbf{HDF5}.
%
This database, depending on the data format it is receiving, will organize
itself in a ``parallel'' or ``hierarchical'' fashion.
%
The user can create as many database objects as needed.
%
The Database objects are defined within the main XML block called
\xmlNode{Databases}:
\begin{lstlisting}[style=XML]
<Simulation>
  ...
  <Databases>
    ...
    <HDF5 name="aDatabaseName1"/>
    <HDF5 name="aDatabaseName2"/>
    ...
  </Databases>
  ...
</Simulation>
\end{lstlisting}
The specifications of each Database of type HDF5 needs to be defined within the
XML block \xmlNode{HDF5}, that recognizes the following attributes:
\vspace{-5mm}
\begin{itemize}
  \itemsep0em
  \item \xmlAttr{name}, \xmlDesc{required string attribute}, a user-defined
  identifier of this object.
  %
  \nb As with other objects, this is name can be used to reference this specific
  entity from other input blocks in the XML.
  \item \xmlAttr{directory}, \xmlDesc{optional string attribute}, this attribute
  can be used to specify a particular directory path where the database will be
  created, if no \textit{filename} is specified, or where to find an already
  existing one if \textit{filename} is provided.
%  \item \xmlAttr{directory}, \xmlDesc{optional string attribute}, this attribute
%  can be used to specify a particular directory path where to create the
%  database, if no \textit{filename} is specified, or from where open an already
%  existing one, if \textit{filename} is provided. \maljdan{Huh?}
  %
  \default{workingDir/framework/DatabaseStorage}.  The \xmlNode{workingDir} is
   the one defined within the \xmlNode{RunInfo} XML block (see Section~\ref{sec:RunInfo}).
  \item \xmlAttr{filename}, \xmlDesc{optional string attribute}, specifies the
  filename of an HDF5 that already exists in the \xmlAttr{directory}.
  %
  This is the only way to let RAVEN know that an HDF5 should be opened and not
  overwritten.
  %
  \nb When this attribute is not specified, the newer database filename will be
  named \texttt{name}.h5, where \textit{name} corresponds to the \xmlAttr{name}
  attribute of this object.
  %
  \default{None}
  \item \xmlAttr{compression}, \xmlDesc{optional string attribute}, compression
  algorithm to be used.
  %
  Available are:
  \begin{itemize}
    \item \xmlString{gzip}, best where portability is required.
    %
    Good compression, moderate speed.
    %
    \item \xmlString{lzf}, Low to moderate compression, very fast.
    %
  \end{itemize}
  \default{None}
\end{itemize}

\begin{lstlisting}[style=XML,morekeywords={directory,filename}]
<Databases>
  <HDF5 name="aDatabaseName1" directory=''path_to_a_dir'' compression=''lzf''/>
  <HDF5 name="aDatabaseName2" filename=''aDatabaseName2.h5''/>
</Databases>
\end{lstlisting}
