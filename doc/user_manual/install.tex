\section{Installation Overview}

The installation of the RAVEN code is a straightforward procedure;
depending on the usage purpose and machine architecture, the
installation process slightly differs.

In the following sections, all the different installation procedures
are reported.

There are two main requirements to installing RAVEN, installing the
RAVEN dependencies (Section \ref{raven_dependencies}) and installing
RAVEN itself (Section \ref{raven_installation}).  For any particular
installation, only one of the raven dependency procedures and one of
the raven installation paths needs to be taken. For some versions of
OSX, there is a RAVEN complete package that combines these steps
(Section \ref{raven_complete}).

For OSX it is recommended that the dependencies be installed with
Miniconda (Section \ref{miniconda}).  For Linux, it is recommended
that the distribution package manager be used if possible (Section
\ref{linux_package_manager}).

There are several different ways of getting RAVEN as described in
Section \ref{raven_installation}.  They vary depending on how easy
they are to use and how easy they are to develop with (these tend to
be inversely correlated).

\newcommand{\goToRavenInstallation}{Now go on to Section \ref{raven_installation} for Raven installation.
}


\section{RAVEN Dependencies Installation}
\label{raven_dependencies}

There are several different ways to install the dependencies that
RAVEN needs.  For OSX, Xcode command line tools and XQuartz are
needed, and then Miniconda is recommended (Section
\ref{osx_dependencies}).  If the MOOSE environment package is
installed, Miniconda is recommended (Section \ref{miniconda_moose}) .
For Linux, the distribution's package manager is recommended (Section
\ref{linux_package_manager}).

\subsection{Linux Package Manager}
\label{linux_package_manager}

If RAVEN is being installed on Linux, it is recommended that the
distribution's package manager be used to install the dependencies.
Below are instructions for doing so in Ubuntu and Fedora.

\subsubsection{Ubuntu}

Install the dependencies using the command:

\begin{lstlisting}[language=bash]
sudo apt-get install libtool git python-dev swig g++ python3-dev \
 python-numpy python-sklearn python-h5py
\end{lstlisting}

Optionally, if you want to be able to edit and rebuild the manual, you can
install \TeX~Live and its related packages:
\begin{lstlisting}[language=bash]
sudo apt-get install texlive-latex-base texlive-extra-utils \
  texlive-latex-extra texlive-math-extra
\end{lstlisting}

\goToRavenInstallation

\subsubsection{Fedora}

Install the dependencies:

\begin{lstlisting}[language=bash]
dnf install swig libtool gcc-c++ python-devel python3-devel \
 numpy h5py scipy python-scikit-learn python-matplotlib-qt4
\end{lstlisting}

Optionally, if you want to be able to edit and rebuild the manual, you can
install \TeX~Live and its related packages:
\begin{lstlisting}[language=bash]
dnf install texlive texlive-subfigure texlive-stmaryrd \
  texlive-titlesec texlive-preprint
\end{lstlisting}

\goToRavenInstallation

\subsection{OSX Dependencies}
\label{osx_dependencies}

For running OSX, there are two additional dependencies that need to be
installed.  The first in the Xcode command line tools.  The second is
XQuartz.  How to install these is explained at
\url{http://mooseframework.org/getting-started/osx/}

Next Miniconda can be used to install the rest of the dependencies
(Section \ref{miniconda})

%command line tools
%x quartz

\subsection{Miniconda}
\label{miniconda}

For OSX, the simplest and most robust way to install the RAVEN dependencies
is with Miniconda.  The details of this vary depending what else is
installed.  Only one of the following subsections should be used.

\subsubsection{With MOOSE}
\label{miniconda_moose}

If running other MOOSE packages is needed, then MOOSE's MOOSE
Environment package comes with miniconda and that should be used to
install the RAVEN dependencies.

Then:
\begin{lstlisting}[language=bash]
sudo bash
#Set up http_proxy and https_proxy variables if needed
conda install numpy hdf5 h5py scipy scikit-learn matplotlib swig
exit #exit from root
\end{lstlisting}

Don't install the RAVEN Miniconda package with the MOOSE Environment
package, they conflict.

\goToRavenInstallation

\subsubsection{Direct Miniconda}

Miniconda can be directly installed using the instructions at: \url{http://conda.pydata.org/miniconda.html}

Then the packages RAVEN needs can be installed:
\begin{lstlisting}[language=bash]
conda install numpy hdf5 h5py scipy scikit-learn matplotlib swig
\end{lstlisting}

\goToRavenInstallation

\subsubsection{With Miniconda package}

For OSX Yosemite and OSX Mavericks there is a package available called
raven\_miniconda.dmg The package includes both miniconda and the
dependencies RAVEN needs.  This package should not be used if the
MOOSE Environment package is installed.

The files will be installed into \texttt{/opt/raven\_libs}.

Your \texttt{.bash\_profile} will be modified to source
the\\ \texttt{/opt/raven\_libs/environments/raven\_libs\_profile}
file.  This needs to be sourced.  Reopening the terminal will put the
correct Miniconda python in the path.

Once this is installed you can go on to Section \ref{raven_installation} and install RAVEN.

\subsection{Manual Dependency Install}

If other options don't work, the dependencies can be installed
manually.  RAVEN uses the following packages (newer versions usually
work):

\begin{enumerate}
\item numpy-1.7.0
\item hdf5-1.8.12
\item Cython-0.18
\item h5py-2.2.1
\item scipy-0.12.0
\item scikit-learn-0.14.1
\item matplotlib-1.4.0
\item swig-2.0.12
\end{enumerate}

You may install these dependencies yourself, or by running the
\texttt{raven\_libs\_script.sh} script provided within the RAVEN distribution:

\begin{lstlisting}[language=bash]
#Only use raven_libs_script.sh if other methods don't work
cd full_path_to_raven_distribution/raven/
./raven_libs_script.sh
cd ..
\end{lstlisting}

If the \texttt{raven\_libs\_script.sh} script is successful it will
install the raven dependencies in \verb'~/raven_libs'

\goToRavenInstallation

\section{RAVEN Installation}
\label{raven_installation}

Once the RAVEN dependencies have been installed (See Section
\ref{raven_dependencies}), the rest of RAVEN can be installed.

There are several different ways to get RAVEN.  There are trade offs
between how easy it is to setup and how easy it is to develop with the
method.  If you are using several MOOSE applications and want to share
the MOOSE directory go to Section \ref{parallel_directory_git}.  If
you want to do development on RAVEN and RAVEN is the only MOOSE
application you are using or you don't mind having duplicate MOOSE
directories, go to Section \ref{submodule_git}.  If you don't need to
do RAVEN development but want to keep up with the latest version of
RAVEN, the RAVEN Whole repository can be used as described in Section
\ref{raven_whole_devel}.  If you don't need to do RAVEN development,
and want to track a stable version of RAVEN, the RAVEN Whole
repository with a stable branch can be used as described in Section
\ref{raven_whole_stable}.  If git is not used, either the Source Code
Package in Section \ref{raven_source_package} or if in OSX the
complete package (Section \ref{raven_complete}) can be used.

\subsection{Parallel Directory Git}
\label{parallel_directory_git}

This install method uses git to obtain the software, and the raven,
crow, and moose directories are installed at the same level.  This is
used to allow other MOOSE applications to share the same MOOSE and
libmesh.

First follow the MOOSE getting started instructions:  \url{http://mooseframework.org/getting-started/}

This is generally:

\begin{lstlisting}[language=bash]
git clone https://github.com/idaholab/moose.git
cd  moose/scripts
./update_and_rebuild_libmesh.sh
cd ../../
\end{lstlisting}

Next Crow and RAVEN need to be cloned:

\begin{lstlisting}[language=bash]
git clone git@hpcgitlab.inl.gov:idaholab/crow.git
git clone git@hpcgitlab.inl.gov:idaholab/raven.git
\end{lstlisting}

If RELAP-7 will be used, only IAPWS should be initialized instead of
all the submodules:

\begin{lstlisting}[language=bash]
git clone git@hpcgitlab.inl.gov:idaholab/relap-7.git
cd relap-7
git submodule update --init contrib/iapws
cd ..
\end{lstlisting}

Next the RAVEN modules should be compiled:

\begin{lstlisting}[language=bash]
cd raven
make framework_modules
\end{lstlisting}

If RELAP-7 is used, the rest of raven can be compiled:

\begin{lstlisting}[language=bash]
#make sure you are in the raven directory
make
\end{lstlisting}


Then the testing should be done.  If RELAP-7 is not used the framework
tests should be run:

\begin{lstlisting}[language=bash]
./run_framework_tests
\end{lstlisting}

If RELAP-7 is used, all the tests can be run:

\begin{lstlisting}[language=bash]
./run_tests
\end{lstlisting}


The output should describe why any tests failed.

At the end, there should be a line that looks similar to the output below:
\begin{lstlisting}[language=bash]
8 passed, 19 skipped, 0 pending, 0 failed
\end{lstlisting}

Normally there are skipped tests because either some of the codes are
not available, or some of the test are not currently working.  The
output will explain why each is skipped.

If all the tests pass, you are ready to read about Running RAVEN in
Section \ref{HowToRun}.

To update the software, the git pull command can be used:

\begin{lstlisting}[language=bash]
cd moose
git pull
#Possibly libmesh needs to be rebuilt at this point.
cd ../crow
git pull
cd ../raven
git pull
\end{lstlisting}

\subsection{Submodule Git}
\label{submodule_git}

This install method uses git to obtain the software and uses
submodules to get Crow and MOOSE.  This can be used for RAVEN and Crow
development.

First RAVEN needs to be cloned, and then the submodules initialized.

\begin{lstlisting}[language=bash]
git clone git@hpcgitlab.inl.gov:idaholab/raven.git
cd raven
git submodule update --init crow moose
\end{lstlisting}

Next follow the compilation and testing instructions in Section \ref{raven_compilation}.

To update the software, the git pull and submodule update commands can
be used:

\begin{lstlisting}[language=bash]
git pull
git submodule update
\end{lstlisting}


\subsection{RAVEN Whole Devel Branch}
\label{raven_whole_devel}

This install method uses git to get a custom repository that includes
only the parts of Crow and MOOSE that are needed by RAVEN.  This
repository is updated every time RAVEN or Crow or MOOSE are changed
and the RAVEN framework tests pass.

First clone the RAVEN whole repository:

\begin{lstlisting}[language=bash]
git clone git@hpcgitlab.inl.gov:cogljj/raven.git
cd raven
\end{lstlisting}

Next follow the compilation and testing instructions in Section \ref{raven_compilation}.

To update the software, the git pull command can be used:

\begin{lstlisting}[language=bash]
git pull
\end{lstlisting}

\subsection{RAVEN Whole Stable Branch}
\label{raven_whole_stable}

This is the same as in the previous Section \ref{raven_whole_devel},
but after the clone command a stable branch is checked out:

\begin{lstlisting}[language=bash]
git clone git@hpcgitlab.inl.gov:cogljj/raven.git
cd raven
git checkout stable/2015_july
\end{lstlisting}

The rest is the same as the RAVEN Whole devel branch.  The stable
branches are updated less frequently, and input changes that would
invalidate existing files are not allowed.

The compilation and testing instructions in Section
\ref{raven_compilation} can be followed.

\subsection{RAVEN Source Code Package}
\label{raven_source_package}

Untar the source install (if there is more than one version of the
source tarball, the full filename will need to be used instead of *):

\begin{lstlisting}[language=bash]
tar -xvzf raven_framework_*_source.tar.gz
cd raven
\end{lstlisting}

Next follow the compilation and testing instructions in Section
\ref{raven_compilation}.

\subsection{RAVEN Compilation}
\label{raven_compilation}

The RAVEN modules should be compiled:

\begin{lstlisting}[language=bash]
#change into the raven directory if needed.
make framework_modules
\end{lstlisting}

Then the testing should be done:

\begin{lstlisting}[language=bash]
./run_framework_tests
\end{lstlisting}

The output should describe why any tests failed.

At the end, there should be a line that looks similar to the output below:
\begin{lstlisting}[language=bash]
8 passed, 19 skipped, 0 pending, 0 failed
\end{lstlisting}

Normally there are skipped tests because either some of the codes are
not available, or some of the test are not currently working.  The
output will explain why each is skipped.

If all the tests pass, you are ready to read about Running RAVEN in
Section \ref{HowToRun}.

If the tests did not pass, check Section
\ref{troubleshooting_installation} on troubleshooting.

\subsection{RAVEN Complete}
\label{raven_complete}

Open up the file \texttt{raven\_framework\_complete\_version.dmg}.

Next, Open up the \texttt{raven\_libs.pkg} inside, and install it.  If
you get an error that the package is not signed, then Control click
the package, and choose ``Open With'' and then Installer.

The files will be installed into \texttt{/opt/raven\_libs}.

Your \texttt{.bash\_profile} will be modified to source
the\\ \texttt{/opt/raven\_libs/environments/raven\_libs\_profile}
file.  This file sets up the environment variables \texttt{PYTHONPATH}
and \texttt{PATH} so that the \texttt{raven\_framework} command can be
used.  The \texttt{.bash\_profile} needs to be sourced.  Reopening the
terminal will source it and put the executable in the path.

\subsection{Troubleshooting the Installation}
\label{troubleshooting_installation}

Often the problems result from one or more of the libraries being
incorrect or missing.  In the raven directory, the command:

\begin{lstlisting}[language=bash]
./run_tests --library_report
\end{lstlisting}
can be used to check if all the libraries are available, and which
ones are being used.  If amsc, distribution1D or interpolationND are
missing, then the RAVEN modules need to be compiled or recompiled.
Otherwise, the RAVEN dependencies need to be fixed.
