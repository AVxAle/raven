\section{Existing Interfaces  \\ \vspace{2 mm} {\small }}
\label{sec:existingInterface}
\subsection{RELAP5 Interface}


\subsubsection{Files}
In the $<Files>$ section, as specified before, there should be specified all the files needed for the code to run. In the case of RELAP5 most of the times the files needed are the following:
\begin{itemize}
\item RELAP5 Input file
\item Table file or files that RELAP needs to run
\item The Relap5 executable
\end{itemize}
Example:
\begin{lstlisting}[style=XML]
<Files>X10.i,tpfh2o,r5executable.x</Files>
\end{lstlisting}

It is a good practice to put inside the working directory all of these files and also:
\begin{itemize}
\item the RAVEN input file
\item the license for the executable of RELAP5
\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Sequence}
In the $<Sequence>$ section there should be specified the names of the steps declared in the $<Steps>$ block. 
So if we called the first multirun: "Grid\_Sampler" and the second multirun: "MC\_Sampler" in the sequence section we should see this:
\begin{lstlisting}[style=XML]
<Sequence>Grid_Sampler,MC_Sampler</Sequence>
\end{lstlisting}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{batchSize and mode}
For the $<batchSize>$ and $<mode>$ sections please take a look at the RunInfo block in the previous chapters.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{RunInfo}
After all of these blocks are filled out here is a standard example of what a RunInfo block can look like:
\begin{lstlisting}[style=XML]
<RunInfo>
    <WorkingDir>~/working_dir</WorkingDir>
    <Files>inputfilerelap.i,tpfh2o,executablerelap5.x</Files>
    <Sequence>Grid_Sampler,MC_Sampler</Sequence>
    <batchSize>1</batchSize>
	<mode>pbsdsh</mode>
    <expectedTime>1:00:00</expectedTime>
    <ParallelProcNumb>1</ParallelProcNumb>
</RunInfo>
\end{lstlisting}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Models}
For the $<Models>$ block here is a standard example of what can be used to use RELAP5 as the external model:
\begin{lstlisting}[style=XML]
<Models>
    <Code name='MyRELAP' subType='Relap5'><executable>~/path_to_the_executable</executable></Code>
</Models>
\end{lstlisting}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Distributions}
In the $<Distribution>$ block are defined the distributions that are going to be used for the sampling of the variables defined in the $<Samplers>$ block. For all the possibile distributions and all their possible inputs please see the chapter about Distributions. Here we give a general example of three different distributions, with the names:
\begin{lstlisting}[style=XML]
<Distributions debug='True'>
    <Triangular name='BPfailtime'>
        <apex>5.0</apex>
        <min>4.0</min>
		<max>6.0</max>
    </Triangular>
    <LogNormal name='BPrepairtime'>
        <mean>0.75</mean>
        <sigma>0.25</sigma>
    </LogNormal>
	<Uniform name='ScalFactPower'>
        <low>1.0</low>
        <hi>1.2</hi>
    </Uniform>
 </Distributions>
\end{lstlisting}
It is good practice to name the distribution something similar to what kind of variable is going to be sampled, since there might be many variables with the same kind of distributions but different input parameters. 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Samplers}
In the $<Samplers>$ block we want to define the variables that are going to be sampled. 
\textbf{Example}:
We want to do the sampling of 3 variables:
\begin{itemize}
\item Battery Fail Time
\item Battery Repair Time
\item Scaling Factor Power Rate
\end{itemize}
We are going to sample these 3 variables using two different sampling methods: grid and MonteCarlo.

In RELAP5 the sampler reads the variable in this way:
Given the name, the first number is the card number, the second number is the word number.
In this example we are sampling:
\begin{itemize}
\item For card 0000588 (trip) the word 6 (battery failure time)
\item For card 0000575 (trip) the word 6 (battery repari time)
\item For card 20210000 (reactor power) the word 4 (reactor scaling factor)
\end{itemize}

We proceed to do so for both the Grid sampling and the MonteCarlo sampling.

\begin{lstlisting}[style=XML]
<Samplers debug='True'>
    <Grid name='Grid_Sampler' initial_seed ='210491' >
        <variable name='0000588:6'>
            <distribution>BPfailtime</distribution>
            <grid type='value' construction='equal' lowerBound='0.0' steps='10'>2880</grid>
        </variable>
        <variable name='0000575:6'>
            <distribution>BPrepairtime</distribution>
            <grid type='value' construction='equal' lowerBound='0.0' steps='10'>2880</grid>
        </variable>
		<variable name='20210000:4'>
            <distribution>ScalFactPower</distribution>
            <grid type='value' construction='equal' lowerBound='1.0' steps='10'>0.02</grid>
	</Grid>
	<MonteCarlo name='MC_Sampler' limit='1000'>
		<variable name='0000588:6'>
            <distribution>BPfailtime</distribution>
		</variable>
		<variable name='0000575:6'>
            <distribution>BPrepairtime</distribution>
		</variable>
		<variable name='20210000:4'>
            <distribution>ScalFactPower</distribution>
		</variable>
	</MonteCarlo>
</Samplers>
\end{lstlisting}
It can be seen that each variable is connected with a proper distribution defined in the $<Distributions>$ block. 
Here is how the Input would be read for the first variable:
\\\\
We are sampling a a variable situated in word 6 of the card 0000588 using a Grid sampling method. The distribution that this variable is following is a Triangular distribution (see section above). We are sampling this variable beginning from 0.0 in 10 \textit{equal} steps of 2880. 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Steps}
For a RELAP interface the steps that are probably going to be used are the $<MultiRun>$. 
First we need to name the step: this name is one the ones used in the $<Sequence>$ block. In this case: Grid\_Sampler and MC\_Sampler.
\begin{lstlisting}[style=XML]
     <MultiRun name='Grid_Sampler' debug='True' re-seeding='210491'>
\end{lstlisting}
With this step with need to import all the files needed for the simulation:
\begin{itemize}
\item RELAP input file
\item Relap 5 Executable
\item elements tables -- tpfh2o 
\end{itemize}
\begin{lstlisting}[style=XML]
    <Input   class='Files' type=''>inputrelap.i</Input>
    <Input   class='Files' type=''>r5executable.x</Input>
    <Input   class='Files' type=''>tpfh2o</Input>
\end{lstlisting}
We then need to define which model it is used:
\begin{lstlisting}[style=XML]
    <Model  class='Models' type='Code'>MyRELAP</Model>
\end{lstlisting}
We then need to specify which Sampler is used, and this can be done as follows:
\begin{lstlisting}[style=XML]
    <Sampler class='Samplers' type='Grid'>Grid_Sampler</Sampler>
\end{lstlisting}
And lastly we need to specify what kind of Output the used wants. For example the user might want to make a DataBase (in RAVEn the DataBase crated is a HDF5 file. Here is a classical example:
\begin{lstlisting}[style=XML]
    <Output  class='DataBases' type='HDF5'>MC_out</Output>
\end{lstlisting}
Following is the example of two MultiRun steps which use different sampling methods (grid and montecarlo), and creating two different DataBases for each one:
\begin{lstlisting}[style=XML]
    <Steps debug='True'>
    <MultiRun name='Grid_Sampler' debug='True' re-seeding='210491'>
        <Input   class='Files'            type=''                >X10.i</Input>
        <Input   class='Files'            type=''                >r5executable.x</Input>
        <Input   class='Files'            type=''                >tpfh2o</Input>
        <Model   class='Models'           type='Code'            >MyRELAP</Model>
        <Sampler class='Samplers'         type='Grid'             >Grid_Sampler</Sampler>
        <Output  class='DataBases'      type='HDF5'  >Grid_out</Output>
    </MultiRun>
	<MultiRun name='MC_Sampler' debug='True' re-seeding='210491'>
        <Input   class='Files'            type=''                >X10.i</Input>
        <Input   class='Files'            type=''                >r5executable.x</Input>
        <Input   class='Files'            type=''                >tpfh2o</Input>
        <Model   class='Models'           type='Code'            >MyRELAP</Model>
        <Sampler class='Samplers'         type='MonteCarlo'             >MC_Sampler</Sampler>
        <Output  class='DataBases'      type='HDF5'  >MC_out</Output>
    </MultiRun>
</Steps>
\end{lstlisting}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{DataBases}
As shown in the $<Steps>$ block, the code is creating two DataBases called Grid\_out and MC\_out. So the user needs to input the following
\begin{lstlisting}[style=XML]
<DataBases>
        <HDF5 name="Grid_out"/> 
        <HDF5 name="MC_out"/> 
</DataBases>
\end{lstlisting}
As listed before, this will create two DataBases. The files are .h5 extension files. 

\subsection{RELAP7 Interface}
\subsubsection{Files}
In the $<Files>$ section, as specified before, there should be specified all the files needed for the code to run. In the case of RELAP7 most of the times the files needed are the following:
\begin{itemize}
\item RELAP7 Input file
\item Control Logic file
\end{itemize}
Example:
\begin{lstlisting}[style=XML]
<Files>nat_circ,control_logic.py</Files>
\end{lstlisting}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Models}
For the $<Models>$ block RELAP7 uses the RAVEN executable. Here is a standard example of what can be used to use RELAP7 as the model:
\begin{lstlisting}[style=XML]
<Models>
    <Code name='MyRAVEN' subType='RAVEN'><executable>~path/to/RAVEN-opt</executable></Code>
</Models>
\end{lstlisting}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Distributions}
The $<Distributions>$ block, when using RELAP7 has to be specified also through the control logic.
Given the names of the distributions, and their parameters, a python file should be used for the control logic.
For example, it is required the sampling of a normal distribution for the primary pressure in RELAP7. 
\begin{lstlisting}[style=XML]
<Distributions>
 <Normal name="Prim_Pres">
 <mean>1000000</mean>
 <sigma>100<sigma/>
 </Normal>
</Distributions>
\end{lstlisting}
The python file associated to it should look like this:
%\lstset{margin=1.5cm}
\begin{lstlisting}[language=Python]
def initial_function(monitored, controlled, auxiliary)
    print("monitored",monitored,"controlled",
    controlled,"auxiliary",auxiliary)  
    
    controlled.pressure_in_pressurizer =
     distributions.Prim_Pres.getDistributionRandom()
    return
\end{lstlisting} 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Samplers}
In the $<Samplers>$ block there are going to be defined both which kind of sampling method used, the variables not sampled inside the control logic and of course which distributions will follow the chosen sampling method.
For the example it was chosen a MonteCarlo sampling with a 500 runs. The global initial pressure wasn't specified in the control logic so it is sampled in this block. It is also specified that such initial pressure has to follow the same distribution as the primary pressure. 
\begin{lstlisting}[style=XML]
<Samplers>
 <MonteCarlo name="MC_samp" limit="500"> 
  <variable name="GlobalParams|global_init_P">
   <distribution>Prim_Pres</distribution>
  </variable>
 </MonteCarlo>
</Samplers>
\end{lstlisting}










